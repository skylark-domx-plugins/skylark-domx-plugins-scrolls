/**
 * skylark-domx-plugins-scrolls - The skylark scrolls plugins library for dom api extension
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx-plugins/skylark-domx-plugins-scrolls/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","skylark-domx-plugins-base","./scrolls"],function(e,t,n,i,o,s,l,r){"use strict";var c=l.Plugin.inherit({klassName:"InfiniteScroll",pluginName:"lark.scrolls.infinitescroll",options:{dataSource:null,hybrid:!1,percentage:95},_construct:function(t,n){this.overrided(t,n),this.$element=this.$(),this.$element.addClass("infinitescroll"),this.curScrollTop=this.$element.scrollTop(),this.curPercentage=this.getPercentage(),this.fetchingData=!1,this.$element.on("scroll.domx.infinitescroll",e.proxy(this.onScroll,this)),this.onScroll()},destroy:function(){return this.$element.remove(),this.$element.empty(),this.$element[0].outerHTML},disable:function(){this.$element.off("scroll.domx.infinitescroll")},enable:function(){this.$element.on("scroll.domx.infinitescroll",e.proxy(this.onScroll,this))},end:function(e){var t=s('<div class="infinitescroll-end"></div>');e?t.append(e):t.append("---------"),this.$element.append(t),this.disable()},getPercentage:function(){var e="border-box"===this.$element.css("box-sizing")?this.$element.outerHeight():this.$element.height(),t=this.$element.get(0).scrollHeight;return t>e?e/(t-this.curScrollTop)*100:0},fetchData:function(e){var t,n=s('<div class="infinitescroll-load"></div>'),o=this,l=function(){var e={percentage:o.curPercentage,scrollTop:o.curScrollTop};i.throb(n[0],{className:"throbWrap"}),o.options.dataSource&&o.options.dataSource(e,function(e){var t;n.remove(),e.content&&o.$element.append(e.content),e.end&&(t=!0!==e.end?e.end:void 0,o.end(t)),o.fetchingData=!1})};this.fetchingData=!0,this.$element.append(n),this.options.hybrid&&!0!==e?(t=s('<button type="button" class="btn btn-primary"></button>'),"object"==typeof this.options.hybrid?t.append(this.options.hybrid.label):t.append('<span class="glyphicon glyphicon-repeat"></span>'),t.on("click.domx.infinitescroll",function(){t.remove(),l()}),n.append(t)):l()},onScroll:function(e){this.curScrollTop=this.$element.scrollTop(),this.curPercentage=this.getPercentage(),!this.fetchingData&&this.curPercentage>=this.options.percentage&&this.fetchData()}});return l.register(c),r.InfiniteScroll=c});
//# sourceMappingURL=sourcemaps/infinite-scroll.js.map
