{"version":3,"sources":["auto-scroll.js"],"names":["define","langx","browser","eventer","noder","finder","geom","styler","$","plugins","scrolls","AutoScroll","Plugin","inherit","klassName","pluginName","options","scrollSensitivity","scrollSpeed","bubbleScroll","_construct","rootEl","this","overrided","autoScrolls","_autoScroll","debounce","x","y","sens","speed","winScroller","scrollingElement","scrollEl","scrollableParent","layersOut","currentParent","scrollWidth","scrollHeight","css","vx","vy","canScrollX","canScrollY","scrollPosX","scrollPosY","el","rect","boundingRect","top","bottom","left","right","width","height","scrollLeft","scrollTop","overflowX","overflowY","Math","abs","i","clearInterval","pid","scrollThisInstance","setInterval","scrollOffsetY","layer","scrollOffsetX","scrollBy","bind","destroy","_clearAutoScrolls","_cancelThrottle","_nulling","handle","_throttleTimeout","forEach","autoScroll","cancel","pointerElemChangedInterval","lastPointerElemX","lastPointerElemY","scrollParentEl","length","register"],"mappings":"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","file":"../auto-scroll.js","sourcesContent":["define([\r\n  \"skylark-langx\",\r\n  \"skylark-domx-browser\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-finder\",\r\n  \"skylark-domx-geom\",\r\n  \"skylark-domx-styler\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-domx-plugins-base\",\r\n  \"./scrolls\"\r\n],function(langx,browser,eventer,noder,finder,geom,styler,$,plugins,scrolls){\r\n\r\n  'use strict';\r\n\r\n\t// INFINITE SCROLL CONSTRUCTOR AND PROTOTYPE\r\n\r\n  var AutoScroll = plugins.Plugin.inherit({\r\n        klassName: \"AutoScroll\",\r\n\r\n        pluginName : \"lark.scrolls.autoscroll\",\r\n\r\n        options : {\r\n\t\t\tscrollSensitivity: 30,\r\n\t\t\tscrollSpeed: 10,\r\n\t\t\tbubbleScroll: true\r\n        },\r\n\r\n        _construct : function(rootEl,options) {\r\n\t        this.overrided(rootEl,options);\r\n    \t\tthis.autoScrolls = [];\r\n\r\n\r\n\t\t\tthis._autoScroll = langx.debounce( (x,y) => {\r\n\t\t\t\t///var _this = rootEl ? rootEl[expando] : window,\r\n\t\t\t\tvar\tsens = options.scrollSensitivity,\r\n\t\t\t\t\tspeed = options.scrollSpeed,\r\n\r\n\t\t\t\t\twinScroller = noder.scrollingElement();\r\n\r\n\t\t\t\tthis.scrollEl = finder.scrollableParent(rootEl, true);\r\n\r\n\r\n\t\t\t\tvar layersOut = 0;\r\n\t\t\t\tvar currentParent = this.scrollEl;\r\n\t\t\t\tvar autoScrolls = this.autoScrolls;\r\n\t\t\t\tdo {\r\n\t\t\t\t\tvar\tel = currentParent,\r\n\t\t\t\t\t\trect = geom.boundingRect(el),\r\n\r\n\t\t\t\t\t\ttop = rect.top,\r\n\t\t\t\t\t\tbottom = rect.bottom,\r\n\t\t\t\t\t\tleft = rect.left,\r\n\t\t\t\t\t\tright = rect.right,\r\n\r\n\t\t\t\t\t\twidth = rect.width,\r\n\t\t\t\t\t\theight = rect.height,\r\n\r\n\t\t\t\t\t\tscrollWidth,\r\n\t\t\t\t\t\tscrollHeight,\r\n\r\n\t\t\t\t\t\tcss,\r\n\r\n\t\t\t\t\t\tvx,\r\n\t\t\t\t\t\tvy,\r\n\r\n\t\t\t\t\t\tcanScrollX,\r\n\t\t\t\t\t\tcanScrollY,\r\n\r\n\t\t\t\t\t\tscrollPosX,\r\n\t\t\t\t\t\tscrollPosY;\r\n\r\n\r\n\t\t\t\t\tscrollWidth = el.scrollWidth;\r\n\t\t\t\t\tscrollHeight = el.scrollHeight;\r\n\r\n\t\t\t\t\tcss = styler.css(el);\r\n\r\n\t\t\t\t\tscrollPosX = el.scrollLeft;\r\n\t\t\t\t\tscrollPosY = el.scrollTop;\r\n\r\n\t\t\t\t\tif (el === winScroller) {\r\n\t\t\t\t\t\tcanScrollX = width < scrollWidth && (css.overflowX === 'auto' || css.overflowX === 'scroll' || css.overflowX === 'visible');\r\n\t\t\t\t\t\tcanScrollY = height < scrollHeight && (css.overflowY === 'auto' || css.overflowY === 'scroll' || css.overflowY === 'visible');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcanScrollX = width < scrollWidth && (css.overflowX === 'auto' || css.overflowX === 'scroll');\r\n\t\t\t\t\t\tcanScrollY = height < scrollHeight && (css.overflowY === 'auto' || css.overflowY === 'scroll');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvx = canScrollX && (Math.abs(right - x) <= sens && (scrollPosX + width) < scrollWidth) - (Math.abs(left - x) <= sens && !!scrollPosX);\r\n\r\n\t\t\t\t\tvy = canScrollY && (Math.abs(bottom - y) <= sens && (scrollPosY + height) < scrollHeight) - (Math.abs(top - y) <= sens && !!scrollPosY);\r\n\r\n\r\n\t\t\t\t\tif (!autoScrolls[layersOut]) {\r\n\t\t\t\t\t\tfor (var i = 0; i <= layersOut; i++) {\r\n\t\t\t\t\t\t\tif (!autoScrolls[i]) {\r\n\t\t\t\t\t\t\t\tautoScrolls[i] = {};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (autoScrolls[layersOut].vx != vx || autoScrolls[layersOut].vy != vy || autoScrolls[layersOut].el !== el) {\r\n\t\t\t\t\t\tautoScrolls[layersOut].el = el;\r\n\t\t\t\t\t\tautoScrolls[layersOut].vx = vx;\r\n\t\t\t\t\t\tautoScrolls[layersOut].vy = vy;\r\n\r\n\t\t\t\t\t\tclearInterval(autoScrolls[layersOut].pid);\r\n\r\n\t\t\t\t\t\tif (el && (vx != 0 || vy != 0)) {\r\n\t\t\t\t\t\t\tthis.scrollThisInstance = true;\r\n\t\t\t\t\t\t\t/* jshint loopfunc:true */\r\n\t\t\t\t\t\t\tautoScrolls[layersOut].pid = setInterval((function () {\r\n\t\t\t\t\t\t\t\tvar scrollOffsetY = autoScrolls[this.layer].vy ? autoScrolls[this.layer].vy * speed : 0;\r\n\t\t\t\t\t\t\t\tvar scrollOffsetX = autoScrolls[this.layer].vx ? autoScrolls[this.layer].vx * speed : 0;\r\n\t\t\t\t\t\t\t\tgeom.scrollBy(autoScrolls[this.layer].el, scrollOffsetX, scrollOffsetY);\r\n\t\t\t\t\t\t\t}).bind({layer: layersOut}), 24);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlayersOut++;\r\n\t\t\t\t} while (options.bubbleScroll && currentParent !== winScroller && (currentParent = finder.scrollableParent(currentParent, false)));\r\n\t\t\t}, 30);\r\n\t\t},\r\n\r\n\t\tdestroy: function () {\r\n\t\t\tthis._clearAutoScrolls();\r\n            this._cancelThrottle();\r\n\t\t\tthis._nulling();\r\n\t\t},\r\n\r\n\r\n\t\thandle : function(x,y) {\r\n\t\t\tthis._throttleTimeout = this._autoScroll(x,y);\r\n\t\t},\r\n\r\n\t\t_clearAutoScrolls : function () {\r\n\t\t\tthis.autoScrolls.forEach(function(autoScroll) {\r\n\t\t\t\tclearInterval(autoScroll.pid);\r\n\t\t\t});\r\n\t\t\tthis.autoScrolls = [];\r\n\t\t},\r\n\r\n\t\t_cancelThrottle : function () {\r\n\t\t\t//clearTimeout(_throttleTimeout);\r\n\t\t\t//_throttleTimeout = void 0;\r\n\t\t\tif (this._throttleTimeout && this._throttleTimeout.cancel) {\r\n\t\t\t\tthis._throttleTimeout.cancel();\r\n\t\t\t\tthis._throttleTimeout = void 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\r\n\t\t_nulling : function () {\r\n\r\n\t\t\t\r\n\t\t\tthis.pointerElemChangedInterval = null;\r\n\t\t\tthis.lastPointerElemX = null;\r\n\t\t\tthis.lastPointerElemY = null;\r\n\r\n\t\t\tthis.scrollEl =\r\n\t\t\tthis.scrollParentEl =\r\n\t\t\tthis.autoScrolls.length = null;\r\n\r\n\t\t}\r\n\r\n  });\r\n\r\n\r\n  plugins.register(AutoScroll);\r\n\r\n  return scrolls.AutoScroll = AutoScroll;\t\r\n});\r\n"]}